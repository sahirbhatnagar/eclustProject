<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Sahir Bhatnagar & Maxime Turgeon">
        <link rel="canonical" href="http://sahirbhatnagar.com/eclust/vignette/">
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Vignette - Eclust</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">Eclust</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Vignette</a>
                    </li>
                
                
                
                    <li >
                        <a href="../references/">References</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="..">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../references/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/sahirbhatnagar/eclust/">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#eclust-vignette">Eclust Vignette</a></li>
        
    
        <li class="main "><a href="#load-required-packages">Load Required Packages</a></li>
        
    
        <li class="main "><a href="#simulate-data">Simulate Data</a></li>
        
    
        <li class="main "><a href="#analysis">Analysis</a></li>
        
            <li><a href="#running-the-strong-heredity-interaction-model-once-using-the-shim-function">Running the Strong heredity interaction model once using the shim function</a></li>
        
            <li><a href="#cross-validation-using-the-cvshim-function">Cross Validation using the cv.shim function</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="eclust-vignette">Eclust Vignette</h1>
<p>Sahir R. Bhatnagar<br />
<code>r Sys.Date()</code>  </p>
<h1 id="load-required-packages">Load Required Packages</h1>
<pre><code class="r">library(knitr)
library(data.table)
library(magrittr)
library(ggplot2)
library(latex2exp)
library(dplyr)
library(plyr)
library(glmnet)
library(stringr)
library(DT)
</code></pre>

<h1 id="simulate-data">Simulate Data</h1>
<pre><code class="r">set.seed(123456)

# number of predictors
p = 10 

# number of test subjects
n = 200

# correlation between X's
rho = 0.50

# signal to noise ratio
signal_to_noise_ratio = 4

# names of the main effects, this will be used in many of the functions
main_effect_names &lt;- paste0(&quot;x&quot;,1:p) 

# names of the active set
true_var_names &lt;- c(&quot;x1&quot;,&quot;x2&quot;,&quot;x3&quot;,&quot;x4&quot;,&quot;x1:x2&quot;, &quot;x1:x3&quot;, &quot;x1:x4&quot;, &quot;x2:x3&quot;, &quot;x2:x4&quot;, &quot;x3:x4&quot;)

# different true coefficient vectors as in Table 1 of Choi et al. 
beta1 &lt;- c(7,2,1,1,0,0,0,0,0,0) %&gt;% magrittr::set_names(true_var_names)
beta2 &lt;- c(7,2,1,1,1,0,0,0.5,0.4,0.1) %&gt;% magrittr::set_names(true_var_names)
beta3 &lt;- c(7,2,1,1,7,7,7,2,2,1) %&gt;% magrittr::set_names(true_var_names)
beta4 &lt;- c(7,2,1,1,14,14,14,4,4,2) %&gt;% magrittr::set_names(true_var_names)
beta5 &lt;- c(0,0,0,0,7,7,7,2,2,1) %&gt;% magrittr::set_names(true_var_names)

# simulate Toeplitz like correlation structure between X's
H &lt;- abs(outer(1:p, 1:p, &quot;-&quot;))
cor &lt;- rho^H

# generate X's from multivariate normal and label the matrix
DT &lt;- MASS::mvrnorm(n = n, mu = rep(0,p), Sigma = cor) %&gt;% 
    magrittr::set_colnames(paste0(&quot;x&quot;,1:p)) %&gt;% 
    set_rownames(paste0(&quot;Subject&quot;,1:n))

# create X matrix which contains all main effects and interactions
# but not the intercept
X &lt;- model.matrix(
    as.formula(paste0(&quot;~(&quot;,paste0(main_effect_names, collapse = &quot;+&quot;),&quot;)^2-1&quot;)), 
    data = DT %&gt;% as.data.frame()) 

# generate response with user defined signal to noise ratio 
y.star &lt;- X[,names(beta4)] %*% beta4
error &lt;- rnorm(n)
k &lt;- sqrt(var(y.star)/(signal_to_noise_ratio*var(error))) 
Y &lt;- y.star + k*error 
colnames(Y) &lt;- &quot;Y&quot;

# names of interaction variables assuming interaction terms contain a &quot;:&quot;
# this will be used in many of the functions
# names must appear in the same order as X matrix
interaction_names &lt;- grep(&quot;:&quot;, colnames(X), value = T)
main_effect_names &lt;- setdiff(colnames(X), interaction_names)
</code></pre>

<h1 id="analysis">Analysis</h1>
<h2 id="running-the-strong-heredity-interaction-model-once-using-the-shim-function">Running the Strong heredity interaction model once using the <code>shim</code> function</h2>
<pre><code class="r"># load eclust library
library(eclust)

res &lt;- shim(x = X, y = Y,
            main.effect.names = main_effect_names,
            interaction.names = interaction_names,
            lambda.beta = NULL,
            lambda.gamma = NULL, 
            nlambda.gamma = 12, 
            nlambda.beta = 10,
            nlambda = 120, 
            threshold = 1e-04, 
            max.iter = 200,
            initialization.type = &quot;ridge&quot;, 
            intercept = TRUE,
            normalize = TRUE, 
            verbose = TRUE, 
            cores = 2)
</code></pre>

<pre><code class="r">names(res)
</code></pre>

<pre><code>##  [1] &quot;b0&quot;                &quot;beta&quot;              &quot;alpha&quot;            
##  [4] &quot;gamma&quot;             &quot;lambda.beta&quot;       &quot;lambda.gamma&quot;     
##  [7] &quot;tuning.parameters&quot; &quot;dfbeta&quot;            &quot;dfalpha&quot;          
## [10] &quot;converged&quot;         &quot;x&quot;                 &quot;y&quot;                
## [13] &quot;bx&quot;                &quot;by&quot;                &quot;sx&quot;               
## [16] &quot;intercept&quot;         &quot;normalize&quot;         &quot;call&quot;             
## [19] &quot;nlambda.gamma&quot;     &quot;nlambda.beta&quot;      &quot;nlambda&quot;          
## [22] &quot;interaction.names&quot; &quot;main.effect.names&quot;
</code></pre>

<h3 id="main-effect-beta-parameter-estimates">Main effect ($\beta$) parameter estimates</h3>
<h3 id="interaction-effect-alpha-parameter-estimates">Interaction effect ($\alpha$) parameter estimates</h3>
<h3 id="sequence-of-tuning-parameters">Sequence of Tuning Parameters</h3>
<h2 id="cross-validation-using-the-cvshim-function">Cross Validation using the <code>cv.shim</code> function</h2>
<pre><code class="r">library(doMC)
registerDoMC(cores = 10)
cv.res &lt;- cv.shim(x = X, y = Y,
            main.effect.names = main_effect_names,
            interaction.names = interaction_names,
            lambda.beta = NULL,
            lambda.gamma = NULL, 
            nlambda.gamma = 12, 
            nlambda.beta = 10,
            nlambda = 120, 
            threshold = 1e-04, 
            max.iter = 200,
            initialization.type = &quot;ridge&quot;, 
            intercept = TRUE,
            normalize = TRUE, 
            verbose = FALSE, 
            parallel = TRUE,
            type.measure = c(&quot;mse&quot;), 
            nfolds = 10)

names(cv.res)
</code></pre>

<pre><code>##  [1] &quot;lambda.beta&quot;     &quot;lambda.gamma&quot;    &quot;cvm&quot;            
##  [4] &quot;cvsd&quot;            &quot;cvup&quot;            &quot;cvlo&quot;           
##  [7] &quot;nz.main&quot;         &quot;name&quot;            &quot;nz.interaction&quot; 
## [10] &quot;shim.fit&quot;        &quot;converged&quot;       &quot;cvm.mat.all&quot;    
## [13] &quot;df&quot;              &quot;lambda.min.beta&quot; &quot;lambda.min.name&quot;
## [16] &quot;lambda.1se.beta&quot; &quot;lambda.1se.name&quot;
</code></pre>

<h3 id="cross-validation-plot">Cross Validation Plot</h3>
<pre><code class="r">plot(cv.res)
</code></pre>

<p><img alt="" src="../eclust-vignette_files/figure-html/unnamed-chunk-7-1.png" /></p>
<h3 id="coefficient-estimates">Coefficient Estimates</h3>
<pre><code class="r">coef(cv.res, s = &quot;lambda.1se&quot;)
</code></pre>

<pre><code>## 56 x 1 sparse Matrix of class &quot;dgCMatrix&quot;
##              Y
## X                    s44
##   (Intercept)  4.4706024
##   x1          12.6502968
##   x2           7.6899616
##   x3          10.2182909
##   x4           .        
##   x5           .        
##   x6           .        
##   x7           3.9026677
##   x8           .        
##   x9           .        
##   x10          .        
##   x1:x2        9.2706249
##   x1:x3       18.3317082
##   x1:x4        .        
##   x1:x5        .        
##   x1:x6        .        
##   x1:x7        0.7652197
##   x1:x8        .        
##   x1:x9        .        
##   x1:x10       .        
##   x2:x3        6.4082682
##   x2:x4        .        
##   x2:x5        .        
##   x2:x6        .        
##   x2:x7        .        
##   x2:x8        .        
##   x2:x9        .        
##   x2:x10       .        
##   x3:x4        .        
##   x3:x5        .        
##   x3:x6        .        
##   x3:x7       -2.6885265
##   x3:x8        .        
##   x3:x9        .        
##   x3:x10       .        
##   x4:x5        .        
##   x4:x6        .        
##   x4:x7        .        
##   x4:x8        .        
##   x4:x9        .        
##   x4:x10       .        
##   x5:x6        .        
##   x5:x7        .        
##   x5:x8        .        
##   x5:x9        .        
##   x5:x10       .        
##   x6:x7        .        
##   x6:x8        .        
##   x6:x9        .        
##   x6:x10       .        
##   x7:x8        .        
##   x7:x9        .        
##   x7:x10       .        
##   x8:x9        .        
##   x8:x10       .        
##   x9:x10       .
</code></pre>

<pre><code class="r">coef(cv.res, s = &quot;lambda.min&quot;)
</code></pre>

<pre><code>## 56 x 1 sparse Matrix of class &quot;dgCMatrix&quot;
##              Y
## X                   s87
##   (Intercept)  5.190222
##   x1          13.212962
##   x2           8.337120
##   x3           8.926785
##   x4           .       
##   x5           .       
##   x6           .       
##   x7           .       
##   x8           .       
##   x9           .       
##   x10          1.871489
##   x1:x2        9.223568
##   x1:x3       18.409148
##   x1:x4        .       
##   x1:x5        .       
##   x1:x6        .       
##   x1:x7        .       
##   x1:x8        .       
##   x1:x9        .       
##   x1:x10       5.373335
##   x2:x3        5.856195
##   x2:x4        .       
##   x2:x5        .       
##   x2:x6        .       
##   x2:x7        .       
##   x2:x8        .       
##   x2:x9        .       
##   x2:x10      -6.956081
##   x3:x4        .       
##   x3:x5        .       
##   x3:x6        .       
##   x3:x7        .       
##   x3:x8        .       
##   x3:x9        .       
##   x3:x10       3.012622
##   x4:x5        .       
##   x4:x6        .       
##   x4:x7        .       
##   x4:x8        .       
##   x4:x9        .       
##   x4:x10       .       
##   x5:x6        .       
##   x5:x7        .       
##   x5:x8        .       
##   x5:x9        .       
##   x5:x10       .       
##   x6:x7        .       
##   x6:x8        .       
##   x6:x9        .       
##   x6:x10       .       
##   x7:x8        .       
##   x7:x9        .       
##   x7:x10       .       
##   x8:x9        .       
##   x8:x10       .       
##   x9:x10       .
</code></pre></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
                <p>Copyright &copy; 2016 <a href="http://sahirbhatnagar.com/">Sahir Bhatnagar</a>, <a href="http://www.math.mcgill.ca/yyang/">Yi Yang</a>, <a href="http://cs.mcgill.ca/~blanchem/">Mathieu Blanchette</a>, <a href="https://www.mcgill.ca/statisticalgenetics/">Celia Greenwood</a></p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
